# email-service
a tiny email signup service

---

Тестовое задание на позицию Golang разработчика

## Инструкция запуску / закрытию приложения
1) Клонируем репозиторий в произвольную директорию

```
git clone git@github.com:cutlery47/email-service.git
cd email-service
```

2) Настраиваем переменные окружения

В корневой директории проекта лежит файл example.env, следующего содержания:

```

SMTP_USERNAME               =                   (почта для доступа к SMTP-серверу)
SMTP_PASSWORD               =                   (пароль для доступа к SMTP-серверу)
SMTP_HOSTNAME               =smtp.gmail.com     (адрес SMTP-сервера)
SMTP_PORT                   =587                (порт SMTP-сервера)

CODE_RUNES                  =123456789          (набор символов, из которых состоит код подтверждения)
CODE_LENGTH                 =10                 (длина кода подтверждения)
CODE_DURATION               =1h                 (длительность жизни кода подтверждения)

CACHE_TYPE                  =redis              (тип кэша, используемого в приложении: map или redis)
CACHE_CLEANUP_TIMEOUT       =1m                 (интервал времени, через который происходит очистка map-кэша)

POSTGRES_USER               =postgres           (имя postgres-пользователя)
POSTGRES_PASSWORD           =12345              (пароль postgres-пользователя)
POSTGRES_HOST               =postgres           (адрес postgres-сервера)
POSTGRES_PORT               =5432               (порт postgres-сервера)
POSTGRES_DB                 =email              (имя postgres-БД)
POSTGRES_TIMEOUT            =5s                 (тайм-аут на подключение к БД)
POSTGRES_MIGRATIONS         =./migrations       (директория с миграциями для БД)

REDIS_DB                    =0                  (база данных redis)
REDIS_HOST                  =redis-service      (адрес redis-сервера)
REDIS_PORT                  =6379               (порт redis-сервера)
REDIS_USER                  =                   (имя redis-пользователя [можно оставить пустым])
REDIS_PASSWORD              =                   (пароль redis-пользователя [можно оставить пустым])

LOGGER_DIR                  =./logs             (директория для логов на локальной машине)
LOGGER_INFO_PATH            =./logs/info.log    (директория для логов информации внутри контейнера)
LOGGER_ERROR_PATH           =./logs/error.log   (директория для логов ошибок внутри контейнера)

SERVER_INTERFACE            =0.0.0.0            (сетевой интерфейс, на котором слушает приложение)
SERVER_PORT                 =8080               (порт, на котором слушает приложение)
SERVER_READ_TIMEOUT         =3s                 (тайм-аут на чтение сервера)
SERVER_WRITE_TIMEOUT        =3s                 (тайм-аут на запись сервера)
SERVER_SHUTDOWN_TIMEOUT     =3s                 (тайм-аут на закрытие сервера)
```

Настоятельно не рекоммендуется изменять уже заданные значения :)

Мануал для настройки SMTP лежит в файте HOWTO-SMTP.md

После заполнения пустых значений следует изменить название файла с example.env на .env

3) Запускаем приложение в Docker-контейнере

`make up_build`

4) Выходим из приложения

`make down`

5) Чистим Docker volumes

`make clean`

## Инструкция по работе с приложением

После запуска приложения, Вы можете проверить статус работы сервиса:

`curl http://localhost:{ВАШ_ПОРТ}/ping`

При корректной работе возвращается пустой ответ

Если приложение работает корректно, Вы можете открыть Swagger-документацию внутри браузера. Для этого нужно открыть страницу по адресу 

`http://localhost:{ВАШ_ПОРТ}/swagger/`

Приложение обрабатывает два эндпойнта:

Первый - сохраняет данные пользователя во временном хранилище и отправляет письмо на указанную почту с целью подтверждения:

`POST: http://localhost:{ВАШ_ПОРТ}/api/v1/register`

JSON-тело запроса:

```
{
  "firstname": "ИМЯ ПОЛЬЗОВАТЕЛЯ",
  "secondname": "ФАМИЛИЯ ПОЛЬЗОВАТЕЛЯ",
  "mail": "ПОЧТА ПОЛЬЗОВАТЕЛЯ",
  "nickname": "НИКНЕЙМ ПОЛЬЗОВАТЕЛЯ"
}
```

Второй - проверяет полученный код подтверждения и оконачательно производит (или отклоняет) регистрацию пользователя

`POST: http://localhost:{ВАШ_ПОРТ}/api/v1/confirm`

JSON-тело запроса:

```
{
  "code": "КОД ПОДТВЕРЖДЕНИЯ",
  "mail": "ПОЧТА ПОЛЬЗОВАТЕЛЯ"
}
```